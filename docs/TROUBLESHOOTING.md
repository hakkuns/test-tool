# トラブルシューティングガイド

## API Test で 502 エラーが発生する

### 原因

502 (Bad Gateway) エラーは、バックエンドのプロキシがテスト対象の API に接続できない場合に発生します。

### よくある原因と解決方法

#### 1. URL が不正または到達不可能

**症状:**

- エラーメッセージ: "Network error: Failed to connect to the API"
- エラー詳細に "Failed to fetch" などのメッセージ

**解決方法:**

- URL が正しいか確認（http:// または https:// で始まる完全な URL）
- テスト対象の API が実際に起動しているか確認
- ブラウザまたは curl で直接アクセスしてテスト

```bash
# curlでテスト
curl -X GET http://localhost:8080/api/users
```

#### 2. dev container から localhost にアクセスできない

**症状:**

- URL に `localhost:8080` などを使用している
- ホストマシンで API は起動しているが、接続エラーになる

**解決方法:**

- **✅ 自動変換機能が有効です！** バックエンドが自動的に `localhost` を `host.docker.internal` に変換します
- それでも接続できない場合は、以下を確認してください：
  1. テスト対象の API が実際に起動しているか
  2. ポート番号が正しいか
  3. ホストマシンのファイアウォール設定

**手動で変更する場合:**

**変更前:**

```
http://localhost:8080/api/users
```

**変更後:**

```
http://host.docker.internal:8080/api/users
```

**注意:** 本番環境や非 dev container 環境では、`localhost`がそのまま使用されます。

#### 3. ファイアウォールやネットワーク制限

**症状:**

- 外部 API へのアクセスがタイムアウトする
- "Connection refused" エラー

**解決方法:**

- ファイアウォール設定を確認
- プロキシ設定が必要な環境の場合、環境変数を設定

#### 4. CORS エラー（異なる原因）

**注意:**
このプロジェクトでは、バックエンドがプロキシとして動作するため、通常は CORS エラーは発生しません。
ただし、テスト対象の API 側がアクセス元の IP アドレスを制限している場合は接続できません。

### デバッグ方法

#### 1. バックエンドのログを確認

バックエンドコンソールで以下のログを確認：

```
Proxy request: { method: 'GET', url: 'http://...', ... }
Network error details: { url: '...', errorMessage: '...' }
```

#### 2. エラー詳細を確認

フロントエンドのエラー表示で以下を確認：

- リクエスト先 URL
- エラーメッセージ
- 所要時間（極端に短い場合は即座に接続拒否されている）

#### 3. 直接テスト

バックエンドコンテナ内から直接 curl でテスト：

```bash
# dev containerのターミナルで
curl -v http://localhost:8080/api/users
# または
curl -v http://host.docker.internal:8080/api/users
```

### 動作確認用のパブリック API

テストには以下のパブリック API が利用できます：

```
GET https://jsonplaceholder.typicode.com/users
GET https://jsonplaceholder.typicode.com/posts/1
```

これらの API で正常に動作すれば、プロキシ機能自体は正常です。

## その他のエラー

### 408 Request Timeout

**原因:**
API のレスポンスが遅く、タイムアウト（デフォルト 30 秒）を超えた

**解決方法:**

- テスト対象の API のパフォーマンスを確認
- 必要に応じてタイムアウト設定を調整（現在は実装されていません）

### 4xx エラー (400, 401, 404 など)

**原因:**
テスト対象の API が正常にエラーレスポンスを返している

**解決方法:**

- リクエストのヘッダー、ボディを確認
- API ドキュメントと照らし合わせる
- 認証トークンなどが必要な場合は、テスト設定のヘッダーに追加

### 5xx エラー (500, 503 など)

**原因:**
テスト対象の API 側でエラーが発生している

**解決方法:**

- テスト対象の API のログを確認
- データベースの状態を確認
- API が正常に起動しているか確認
