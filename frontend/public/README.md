# Testing Assistant Suite 使い方

## 概要

Testing Assistant Suite は、PostgreSQL データベースと API のテストを効率化するためのツールです。テストシナリオを作成し、テーブル定義、テストデータ、モック API を統合管理できます。

## 主な機能

### 1. テストシナリオ管理

テストシナリオを作成・編集・削除できます。各シナリオには以下の要素を設定できます：

- **基本情報**: シナリオ名、説明、タグ
- **対象 API**: テスト対象の API エンドポイント
- **テーブル定義**: DDL でテーブル構造を定義
- **テストデータ**: テーブルに投入するデータ
- **モック API**: 外部 API の振る舞いをシミュレート

### 2. グループ管理

関連するシナリオをグループ化して整理できます。

### 3. データベース接続

PostgreSQL データベースに接続し、テーブルの作成やデータの投入を自動化します。ナビゲーションバーに接続状態が表示されます：

- 🟢 **接続中**: データベースに正常に接続されています
- 🔴 **未接続**: データベースに接続できていません

## 基本的な使い方

### シナリオの作成

1. ホーム画面右上の「**新規作成**」ボタンをクリック
2. 基本情報を入力
   - シナリオ名（必須）
   - 説明（任意）
   - グループ（任意）
   - タグ（任意）
3. 対象 API を設定
   - HTTP メソッド（GET、POST、PUT、DELETE 等）
   - URL
4. 必要に応じてテーブル定義、データ、モック API を追加
5. 「**保存**」ボタンで保存

### テーブル定義の追加

1. 「テーブル定義」セクションで「**追加**」をクリック
2. DDL（CREATE TABLE 文）を入力
3. 依存関係がある場合は、依存するテーブル名を指定

### テストデータの追加

1. 「テーブルデータ」セクションで「**追加**」をクリック
2. 対象テーブルを選択
3. JSON 形式でデータを入力
4. データ投入前にテーブルをクリアする場合は「投入前に TRUNCATE」をチェック

### モック API の追加

1. 「モック API」セクションで「**追加**」をクリック
2. 名前（任意）、HTTP メソッド、パスを設定
3. レスポンスのステータスコードとボディを設定
4. 必要に応じてヘッダーも設定

### モック API の使用

作成したモック API のエンドポイント URL は以下の形式です：

```
http://localhost:3001/api/mock/serve/{パス}
```

例えば、モック API で `/users` というパスを設定した場合、実際のエンドポイントは：

```
http://localhost:3001/api/mock/serve/users
```

テスト対象のアプリケーションで、この URL を設定してモック API を利用してください。

**重要**: アプリケーション側で API のベース URL を変更する必要があります。

**⚠️ devContainer からモック API に接続する場合:**

devContainer 内で動作するアプリケーションからモック API に接続する場合、`localhost` の代わりに `host.docker.internal` を使用してください。

例:
```
http://host.docker.internal:3001/api/mock/serve/users
```

これにより、devContainer からホストマシン上で動作している Testing Assistant Suite のモック API に正しくアクセスできます。

### シナリオの実行

1. ホーム画面でシナリオカードの「**編集**」ボタンをクリック
2. 編集画面上部の「**シナリオを適用**」ボタンをクリック
3. 確認ダイアログで「OK」をクリック
4. テーブル作成、データ投入、モック API 設定が自動実行されます

## インポート・エクスポート

### エクスポート

- **個別エクスポート**: シナリオカードの「Export」ボタン
- **一括エクスポート**: ホーム画面右上の「全エクスポート」ボタン

### インポート

1. ホーム画面右上の「**インポート**」ボタンをクリック
2. JSON 形式のシナリオファイルを選択

## Tips

- **グループ機能**: 大量のシナリオを扱う場合、グループで整理すると管理しやすくなります
- **タグ機能**: 検索やフィルタリングに便利です（例: `smoke-test`, `regression`）
- **モック API 名**: モック API には分かりやすい名前を付けると、後から見直す際に便利です
- **JSON 形式**: データやレスポンスボディは有効な JSON 形式で入力してください

## トラブルシューティング

### データベースに接続できない

1. 環境変数の設定を確認
2. PostgreSQL サーバーが起動しているか確認
3. ネットワーク接続を確認

### テーブルが作成できない

1. DDL 構文が正しいか確認
2. 依存関係の順序が正しいか確認
3. 既に同名のテーブルが存在していないか確認

### データが投入できない

1. テーブルが既に存在しているか確認
2. JSON 形式が正しいか確認
3. カラム名とデータ型が一致しているか確認

## サポート

問題が解決しない場合は、開発チームにお問い合わせください。
